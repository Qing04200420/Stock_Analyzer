# 🎯 權證查詢功能說明

**更新日期**: 2026-01-10
**版本**: 1.0

---

## ✨ 新功能概述

權證分析頁面新增了**股票代碼查詢權證**功能，讓使用者能夠：
1. 輸入股票代碼查詢相關權證
2. 從列表中選擇感興趣的權證
3. 獲取該權證的完整分析報告

---

## 🔍 功能流程

### 步驟 1: 輸入股票代碼

1. 進入「權證分析」頁面
2. 選擇「🔍 權證查詢」標籤
3. 在搜尋框中輸入股票代碼（例如: 2330, 2317, 2454）
4. 點擊「🔍 查詢權證」按鈕

### 步驟 2: 檢視權證列表

系統會顯示該股票所有可用的權證，包含以下資訊：
- **權證代碼**: 唯一識別碼
- **權證名稱**: 權證全名
- **權證類型**: 認購或認售
- **發行商**: 券商名稱
- **履約價**: 行使權證的價格
- **行使比例**: 轉換比率
- **到期日**: 權證到期日期
- **權證價格**: 當前市價

### 步驟 3: 選擇權證進行分析

1. 從下拉選單中選擇要分析的權證
2. 系統會自動獲取標的股票的最新價格
3. 可以調整以下參數：
   - **當前股價**: 用於計算的股價（自動填入最新價）
   - **隱含波動率**: 市場預期的波動率（預設 30%）
4. 點擊「🚀 開始分析」按鈕

### 步驟 4: 檢視分析結果

系統會顯示完整的權證分析報告，包括：

#### 📋 權證基本資訊
- 權證代碼、名稱、類型
- 標的股票代碼
- 履約價、行使比例
- 當前股價、到期天數

#### 💎 核心評估指標
- **理論價格**: 使用 Black-Scholes 模型計算的理論價值
- **內含價值**: 立即行使的價值
- **時間價值**: 權證價格減去內含價值
- **綜合評分**: 0-100 分的綜合評估

#### 📊 詳細資訊

**🎯 權證狀態**:
- 價內外狀態（深度價內/價內/價平/價外）
- 實質槓桿（考慮 Delta 的槓桿倍數）
- 到期天數
- 損益兩平點

**📈 Greeks 風險指標**:
- **Delta (Δ)**: 價格敏感度（股價變動 1 元，權證價格變動）
- **Gamma (Γ)**: Delta 變化率（Delta 的敏感度）
- **Theta (Θ)**: 時間價值衰減（每日損失的時間價值）
- **Vega (ν)**: 波動率敏感度（波動率變動 1% 的影響）

#### 💡 投資建議
系統根據綜合評分給出建議：
- 🟢 **推薦買進** (評分 ≥ 65)
- 🟡 **謹慎評估** (評分 35-65)
- 🔴 **不建議買進** (評分 < 35)

---

## 📊 示範資料

系統目前提供以下股票的權證資料：

### 台積電 (2330)
- **070001** - 元大01認購（履約價 650, 行使比例 0.5）
- **070002** - 凱基02認購（履約價 700, 行使比例 0.6）
- **070003** - 國泰03認購（履約價 750, 行使比例 0.4）
- **070004** - 元大04認售（履約價 550, 行使比例 0.5）
- **070005** - 富邦05認購（履約價 680, 行使比例 0.7）

### 鴻海 (2317)
- **071001** - 元大06認購（履約價 110, 行使比例 0.3）
- **071002** - 凱基07認購（履約價 120, 行使比例 0.4）

### 聯發科 (2454)
- **072001** - 國泰08認購（履約價 850, 行使比例 0.4）
- **072002** - 元大09認售（履約價 750, 行使比例 0.5）

---

## 🔧 技術實現

### 後端模組

#### WarrantDataFetcher (data_fetcher.py)
```python
class WarrantDataFetcher:
    def __init__(self):
        # 初始化權證資料庫

    def get_warrant_list(self, stock_id: str = None) -> pd.DataFrame:
        # 獲取權證列表

    def get_warrant_detail(self, warrant_code: str) -> Dict:
        # 獲取單一權證詳細資訊
```

#### WarrantAnalyzer (warrant_analyzer.py)
```python
class WarrantAnalyzer:
    def analyze_warrant(self, warrant_info: Dict, stock_price: float,
                       volatility: float) -> Dict:
        # 使用 Black-Scholes 模型進行完整分析
        # 計算 Greeks、評分、投資建議
```

### 前端實現

**位置**: [app.py:1673-1949](app.py#L1673-L1949)

主要功能：
1. **股票代碼輸入**: 使用 `st.text_input` 接收用戶輸入
2. **權證列表顯示**: 使用 `st.dataframe` 展示查詢結果
3. **權證選擇**: 使用 `st.selectbox` 讓用戶選擇
4. **自動獲取股價**: 整合 `data_fetcher` 獲取最新股價
5. **參數設定**: `st.number_input` 和 `st.slider` 調整參數
6. **結果展示**: 使用自定義 HTML/CSS 美化顯示

---

## 💡 使用技巧

### 1. 如何選擇合適的權證？

**認購權證** (看漲)：
- 當你認為股價會上漲時選擇
- 選擇「價平」或「淺價內」的權證較為平衡
- Delta 在 0.4-0.7 之間較理想

**認售權證** (看跌)：
- 當你認為股價會下跌時選擇
- 選擇「價平」或「淺價內」的權證
- Delta 在 -0.4 到 -0.7 之間較理想

### 2. 評估指標重點

**實質槓桿**：
- 2-6 倍：穩健型
- 6-10 倍：積極型
- >10 倍：高風險

**到期天數**：
- >90 天：時間充裕
- 60-90 天：適中
- <30 天：高風險（時間價值快速流失）

**綜合評分**：
- 80-100 分：優質標的
- 65-79 分：良好標的
- 50-64 分：普通標的
- <50 分：不建議

### 3. Greeks 解讀

**Delta 高** (接近 ±1)：
- 優點：與股票價格連動性高
- 缺點：槓桿效果較低

**Theta 負值大**：
- 警告：時間價值流失快
- 建議：不適合長期持有

**Vega 高**：
- 特點：對波動率敏感
- 適合：預期波動率上升時

---

## ⚠️ 風險提示

1. **槓桿風險**: 權證具有高槓桿特性，可能造成重大損失
2. **時間價值衰減**: 接近到期日時，時間價值加速流失
3. **流動性風險**: 部分權證可能流動性不足
4. **價外歸零**: 到期時如為價外，權證價值歸零
5. **示範資料**: 本系統使用示範資料，實際投資前請查證真實市場資訊

---

## 🎓 延伸閱讀

### Black-Scholes 模型
權證定價的核心模型，考慮以下因素：
- 標的股票當前價格 (S)
- 履約價格 (K)
- 到期時間 (T)
- 無風險利率 (r)
- 波動率 (σ)

### Greeks 詳解
- **Delta**: 衡量方向性風險
- **Gamma**: 衡量 Delta 的穩定性
- **Theta**: 衡量時間衰減速度
- **Vega**: 衡量波動率風險
- **Rho**: 衡量利率風險（本系統已計算但未顯示）

---

## 🔄 未來改進

1. **即時資料**: 連接真實權證交易所 API
2. **進階篩選**: 增加更多篩選條件（成交量、價差等）
3. **歷史回測**: 顯示權證歷史表現
4. **比較功能**: 並排比較多個權證
5. **提醒功能**: 設定價格提醒和到期提醒
6. **下單整合**: 與券商 API 整合直接下單

---

## 📞 支援

如有問題或建議，請聯繫系統管理員。

**功能開發**: Claude Sonnet 4.5
**系統版本**: 1.0
**最後更新**: 2026-01-10

---

**注意**: 本系統僅供教育和研究用途，不構成投資建議。投資前請諮詢專業財務顧問。
