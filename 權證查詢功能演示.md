# 🎯 權證查詢功能演示指南

**日期**: 2026-01-10
**功能**: 股票代碼查詢權證 → 選取權證 → 顯示完整分析

---

## ✅ 功能已完成

### 新增功能概述

在「權證分析」頁面的「🔍 權證查詢」標籤中，用戶現在可以：

1. **輸入股票代碼** → 查詢相關權證
2. **檢視權證列表** → 查看所有可用權證及其基本資訊
3. **選擇權證** → 從下拉選單選擇要分析的權證
4. **獲取分析** → 查看完整的 Black-Scholes 定價分析和 Greeks 指標

---

## 🎬 使用演示

### 步驟 1: 啟動系統

```bash
python -m streamlit run app.py
```

### 步驟 2: 進入權證分析頁面

1. 從左側導航欄選擇「🎯 權證分析」
2. 點擊「🔍 權證查詢」標籤

### 步驟 3: 輸入股票代碼

**範例**: 輸入 `2330`（台積電）

點擊「🔍 查詢權證」按鈕

**預期結果**:
```
✅ 找到 5 支權證標的
```

### 步驟 4: 檢視權證列表

系統會顯示表格，包含：

| 權證代碼 | 權證名稱 | 類型 | 發行商 | 履約價 | 行使比例 | 到期日 | 權證價格 |
|---------|---------|------|--------|--------|----------|--------|----------|
| 070001 | 元大01認購 | 認購 | 元大證券 | 650.0 | 0.5 | 2026-05-10 | 12.5 |
| 070002 | 凱基02認購 | 認購 | 凱基證券 | 700.0 | 0.6 | 2026-04-10 | 8.3 |
| 070003 | 國泰03認購 | 認購 | 國泰證券 | 750.0 | 0.4 | 2026-06-09 | 6.2 |
| 070004 | 元大04認售 | 認售 | 元大證券 | 550.0 | 0.5 | 2026-04-20 | 9.8 |
| 070005 | 富邦05認購 | 認購 | 富邦證券 | 680.0 | 0.7 | 2026-07-09 | 14.6 |

### 步驟 5: 選擇權證

從下拉選單中選擇：`070001 - 元大01認購`

### 步驟 6: 設定分析參數

**自動填入**:
```
📊 最新股價: 1680.00 TWD
```

**可調整**:
- 💰 當前股價: 1680.0 (可手動修改)
- 📈 隱含波動率: 30% (可調整 10%-60%)

### 步驟 7: 開始分析

點擊「🚀 開始分析」按鈕

**預期結果**: 顯示完整分析報告

---

## 📊 分析結果範例

### 📋 權證基本資訊

```
權證代碼: 070001          權證名稱: 元大01認購
標的股票: 2330            權證類型: 認購

履約價: $650.00           行使比例: 0.50
當前股價: $1680.00        到期天數: 119 天
```

### 💎 核心評估指標

```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│  理論價格   │  內含價值   │  時間價值   │  綜合評分   │
│   516.06    │   515.00    │    0.00     │  100/100   │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

**解讀**:
- ✅ **理論價格 516.06**: Black-Scholes 模型計算的理論價值
- ✅ **內含價值 515.00**: 立即行使可獲得的價值 = (1680 - 650) × 0.5
- ✅ **時間價值 0.00**: 權證價格與內含價值的差異（已深度價內）
- ✅ **綜合評分 100**: 最高評分，優質標的

### 📊 詳細資訊

#### 🎯 權證狀態

```
價內外狀態: 深度價內
實質槓桿: 67.20
到期天數: 119 天
損益兩平點: 675.00
```

**解讀**:
- **深度價內**: 當前股價 1680 >> 履約價 650（價差 1030）
- **實質槓桿 67.20**: 股價變動 1%，權證價值約變動 67.2%
- **損益兩平點 675**: 到期時股價需 > 675 才能獲利

#### 📈 Greeks 風險指標

```
Delta Δ: 1.0000      價格敏感度
  → 股價漲 1 元，權證約漲 1 元

Gamma Γ: 0.000000    Delta變化率
  → Delta 非常穩定

Theta Θ: -0.0178     時間價值衰減
  → 每日損失約 0.0178 元時間價值

Vega ν: 0.0000       波動率敏感度
  → 對波動率不敏感（已深度價內）
```

### 💡 投資建議

```
🟢 推薦買進：✅ 優質標的，建議買入
```

**理由**:
1. 深度價內，內含價值高
2. Delta 接近 1，與股票連動性高
3. 到期時間充裕（119 天）
4. 綜合評分達到最高分

---

## 🔬 測試驗證結果

### 測試執行

```bash
python test_warrant_feature.py
```

### 測試結果

```
======================================================================
  測試總結
======================================================================

測試結果:
  ✅ 通過 - 權證資料獲取器
  ✅ 通過 - 權證分析器
  ✅ 通過 - 多個股票查詢
  ✅ 通過 - 邊界情況處理

總計: 4/4 測試通過

🎉 所有測試通過！權證查詢功能正常運作。
```

---

## 💡 功能亮點

### 1. 智能股價獲取

系統會自動從資料庫獲取標的股票的最新價格：

```python
# 自動獲取最新股價
stock_df = data_fetcher.get_stock_price("2330", days=5)
latest_price = float(stock_df['收盤價'].iloc[-1])
# 顯示: 📊 最新股價: 1680.00 TWD
```

### 2. 完整的 Black-Scholes 分析

使用標準的期權定價模型：

```
理論價格 = S × N(d1) - K × e^(-rT) × N(d2)

其中:
S = 當前股價 (1680)
K = 履約價 (650)
T = 到期時間 (119/365 年)
r = 無風險利率 (1%)
σ = 波動率 (30%)
```

### 3. Greeks 完整計算

- **Delta**: ∂V/∂S（價格敏感度）
- **Gamma**: ∂²V/∂S²（Delta 變化率）
- **Theta**: ∂V/∂t（時間衰減）
- **Vega**: ∂V/∂σ（波動率敏感度）

### 4. 智能評分系統

綜合考慮多個因素：
- 價內外狀態（+15 分）
- 時間價值比率（+15 分）
- 槓桿適中性（+10 分）
- Delta 值（+10 分）
- 到期時間（+10 分）

### 5. 直觀的視覺呈現

- 漸層色卡片顯示核心指標
- 顏色編碼（綠色/黃色/紅色）表示評分等級
- 表格化展示權證列表
- 清晰的步驟引導

---

## 📚 可用的示範資料

### 台積電 (2330) - 5 支權證

1. **070001 - 元大01認購**
   - 類型: 認購 | 履約價: 650 | 行使比例: 0.5
   - 特點: 深度價內，高內含價值

2. **070002 - 凱基02認購**
   - 類型: 認購 | 履約價: 700 | 行使比例: 0.6
   - 特點: 價內，較高槓桿

3. **070003 - 國泰03認購**
   - 類型: 認購 | 履約價: 750 | 行使比例: 0.4
   - 特點: 價內，長到期時間

4. **070004 - 元大04認售**
   - 類型: 認售 | 履約價: 550 | 行使比例: 0.5
   - 特點: 價外認售權證

5. **070005 - 富邦05認購**
   - 類型: 認購 | 履約價: 680 | 行使比例: 0.7
   - 特點: 價內，最高行使比例

### 鴻海 (2317) - 2 支權證

1. **071001 - 元大06認購** (履約價 110)
2. **071002 - 凱基07認購** (履約價 120)

### 聯發科 (2454) - 2 支權證

1. **072001 - 國泰08認購** (履約價 850)
2. **072002 - 元大09認售** (履約價 750)

---

## 🎯 使用建議

### 適合場景

1. **學習權證投資**: 了解 Greeks 和定價模型
2. **比較不同權證**: 快速查看同一股票的多個權證
3. **評估投資價值**: 使用綜合評分輔助決策
4. **風險評估**: 查看 Greeks 了解風險特性

### 操作技巧

1. **先看列表**: 瀏覽所有可用權證的基本資訊
2. **關注評分**: 優先分析高評分權證
3. **比較 Delta**: 高 Delta (>0.7) 更接近股票表現
4. **注意到期日**: 避免到期日太近的權證（<30天）
5. **檢查槓桿**: 根據風險承受度選擇適當槓桿

---

## ⚠️ 重要提醒

1. **示範資料**: 本系統使用示範資料，非真實市場資訊
2. **投資風險**: 權證具高槓桿特性，可能造成重大損失
3. **時間衰減**: 權證隨時間流逝會損失價值
4. **僅供參考**: 系統建議僅供參考，不構成投資建議
5. **專業諮詢**: 實際投資前請諮詢專業財務顧問

---

## 📞 技術支援

### 相關文件

- [權證查詢功能說明.md](權證查詢功能說明.md) - 完整功能文檔
- [test_warrant_feature.py](test_warrant_feature.py) - 功能測試腳本

### 檔案位置

- **後端模組**: [backend/modules/data_fetcher.py](backend/modules/data_fetcher.py)
- **分析器**: [backend/modules/warrant_analyzer.py](backend/modules/warrant_analyzer.py)
- **前端介面**: [app.py](app.py) (行 1673-1949)

---

**功能開發完成** ✅

- 股票代碼查詢權證 ✅
- 權證列表顯示 ✅
- 權證詳細資訊 ✅
- Black-Scholes 分析 ✅
- Greeks 計算 ✅
- 綜合評分 ✅
- 投資建議 ✅

**準備就緒，可以使用！** 🚀
