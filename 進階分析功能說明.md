# 🚀 進階分析功能說明

**更新日期**: 2026-01-10
**版本**: 2.0

---

## 📋 目錄

1. [功能概覽](#功能概覽)
2. [技術分析](#技術分析)
3. [多股比較](#多股比較)
4. [投資組合管理](#投資組合管理)
5. [市場情緒分析](#市場情緒分析)
6. [使用建議](#使用建議)

---

## 🎯 功能概覽

本次更新新增了四個專業級進階分析模組：

| 模組 | 功能 | 適用場景 |
|------|------|----------|
| 📈 技術分析 | 完整技術指標與交易訊號 | 短中期交易決策 |
| 📊 多股比較 | 橫向比較多支股票 | 選股與配置 |
| 💼 投資組合 | 持倉管理與績效追蹤 | 長期投資管理 |
| 🎭 市場情緒 | 整體市場情緒分析 | 市場時機判斷 |

---

## 📈 技術分析

### 功能特色

提供完整的技術指標分析工具，幫助投資者掌握股價走勢與交易時機。

### 支援指標

#### 1. 移動平均線 (MA/EMA)
- **短期均線**: MA5（預設5日）
- **中期均線**: MA20（預設20日）
- **長期均線**: MA60（預設60日）
- **指數移動平均**: EMA 提供更敏感的趨勢反應

**交易訊號**:
- 黃金交叉：短期均線上穿長期均線 → 買入訊號
- 死亡交叉：短期均線下穿長期均線 → 賣出訊號

#### 2. MACD (指數平滑異同移動平均線)
- **快線**: 預設 12 日 EMA
- **慢線**: 預設 26 日 EMA
- **信號線**: 預設 9 日 EMA
- **柱狀圖**: MACD - 信號線

**交易訊號**:
- MACD 上穿信號線 → 買入
- MACD 下穿信號線 → 賣出
- 柱狀圖由負轉正 → 動能轉強

#### 3. RSI (相對強弱指標)
- **週期**: 預設 14 日
- **超買區**: > 70
- **超賣區**: < 30
- **中性區**: 30-70

**交易訊號**:
- RSI < 30 → 超賣，考慮買入
- RSI > 70 → 超買，考慮賣出
- RSI 背離 → 趨勢可能反轉

#### 4. KDJ (隨機指標)
- **%K**: 快速隨機指標
- **%D**: 慢速隨機指標
- **%J**: 超前指標

**交易訊號**:
- K 線上穿 D 線且位於 20 以下 → 買入
- K 線下穿 D 線且位於 80 以上 → 賣出

#### 5. 布林通道 (Bollinger Bands)
- **中軌**: 20 日移動平均線
- **上軌**: 中軌 + 2 倍標準差
- **下軌**: 中軌 - 2 倍標準差

**交易訊號**:
- 價格觸及下軌 → 可能反彈
- 價格觸及上軌 → 可能回落
- 通道收窄 → 波動率降低，醞釀突破

#### 6. ATR (真實波動幅度均值)
- 衡量市場波動程度
- 用於設定停損點

#### 7. OBV (能量潮指標)
- 結合成交量與價格走勢
- 判斷資金流向

### 使用流程

1. **輸入股票代碼**: 例如 2330（台積電）
2. **選擇分析週期**: 30/60/90/180/365 天
3. **點擊開始分析**: 系統自動計算所有指標
4. **查看圖表**: K線圖、各項技術指標圖表
5. **參考交易訊號**: 系統綜合各指標給出買賣建議

### 交易訊號邏輯

系統會綜合以下因素生成交易訊號：

- **買入訊號** (3個以上條件符合):
  - MA 黃金交叉
  - MACD 上穿信號線
  - RSI < 30 (超賣)
  - KDJ 黃金交叉於低檔
  - 價格接近布林下軌

- **賣出訊號** (3個以上條件符合):
  - MA 死亡交叉
  - MACD 下穿信號線
  - RSI > 70 (超買)
  - KDJ 死亡交叉於高檔
  - 價格接近布林上軌

- **持有訊號**: 不符合明確買賣條件

---

## 📊 多股比較

### 功能特色

同時分析多支股票，進行橫向比較，找出相對強勢或弱勢標的。

### 比較指標

#### 1. 價格表現
- **漲跌幅(%)**: 期間內價格變動百分比
- **起始價格**: 分析期間第一天的收盤價
- **結束價格**: 最新收盤價
- **最高價/最低價**: 期間內的極值

#### 2. 報酬率分析
- **總報酬率**: 持有期間的報酬
- **年化報酬率**: 換算成年化數據
- **平均日報酬**: 每日平均報酬率
- **累積報酬**: 複利累積效果

#### 3. 風險指標
- **年化波動率**: 價格波動程度（標準差 × √252）
- **夏普比率**: 風險調整後報酬 = (報酬率 - 無風險利率) / 波動率
- **最大回撤**: 期間內最大跌幅
- **VaR**: 在險價值（95% 信賴區間）

#### 4. 成交量分析
- **平均成交量**: 日均成交量
- **成交量變化**: 相較期初的成交量變動
- **換手率**: 股票流動性指標

### 視覺化圖表

1. **標準化價格走勢圖**
   - 將所有股票起始價格標準化為 100
   - 便於比較相對表現

2. **成交量比較圖**
   - 各股票成交量時間序列
   - 觀察資金流向

3. **日報酬率分布圖**
   - 直方圖顯示報酬率分布
   - 了解報酬特性與風險

4. **比較摘要表**
   - 彩色熱力圖標示
   - 綠色：表現較好
   - 紅色：表現較差

### 使用場景

- **選股**: 從多支候選股中選出表現最佳者
- **配置**: 決定投資組合中各股票的比重
- **產業比較**: 比較同產業不同公司的表現
- **對沖**: 找出負相關的股票進行對沖

### 使用流程

1. **輸入股票代碼**: 用逗號分隔，例如 2330,2317,2454
2. **選擇分析週期**: 30-365 天
3. **點擊開始比較**: 系統同時抓取所有股票資料
4. **查看比較結果**: 表格、圖表、分析報告

---

## 💼 投資組合管理

### 功能特色

完整的投資組合管理工具，追蹤持倉、計算績效、評估風險。

### 核心功能

#### 1. 持倉管理
- **新增持倉**: 記錄股票代碼、股數、成本價
- **修改持倉**: 調整持股數量或成本
- **移除持倉**: 刪除已賣出的股票
- **持倉查詢**: 即時查看所有持倉資訊

#### 2. 價值計算
- **總投資成本**: Σ(股數 × 成本價)
- **當前市值**: Σ(股數 × 最新股價)
- **總損益**: 當前市值 - 總投資成本
- **報酬率**: (總損益 / 總投資成本) × 100%

#### 3. 績效分析
- **年化報酬率**: 持有期間報酬年化
- **夏普比率**: 風險調整後報酬
- **最大回撤**: 組合歷史最大跌幅
- **勝率**: 獲利股票數 / 總股票數

#### 4. 風險指標
- **組合波動率**: 整體價格波動程度
- **Beta 係數**: 相對於大盤的敏感度
- **VaR (95%)**: 最壞情況下的可能損失
- **CVaR**: 條件在險價值（超過 VaR 的平均損失）

#### 5. 持倉分布
- **持倉比例圓餅圖**: 各股票佔比
- **產業分布**: 不同產業的配置比例
- **損益排名**: 表現最好與最差的股票

#### 6. 優化建議
- **再平衡建議**: 根據偏離度建議調整
- **風險警示**: 單一股票持倉過高警告
- **配置建議**: 基於風險承受度的建議配置

### 使用流程

#### 建立投資組合

1. 進入「新增持倉」標籤
2. 輸入股票代碼（例如：2330）
3. 輸入持有股數（例如：1000 股）
4. 輸入成本價（例如：600 元）
5. 點擊「加入組合」

重複以上步驟添加所有持倉。

#### 查看組合概覽

- **總覽數據**: 總成本、市值、損益、報酬率
- **持倉明細**: 每支股票的詳細資訊
- **持倉分布**: 圓餅圖顯示各股佔比
- **損益排名**: 表現最好/最差的股票

#### 績效分析

1. 選擇「績效分析」標籤
2. 設定分析週期（例如：90 天）
3. 點擊「分析績效」
4. 查看：
   - 風險指標（報酬率、波動率、夏普比率、最大回撤）
   - 組合價值走勢圖
   - 詳細分析報告

### 實際案例

假設投資組合如下：

| 股票 | 股數 | 成本價 | 投資成本 | 最新股價 | 市值 | 損益 | 報酬率 |
|------|------|--------|----------|----------|------|------|--------|
| 2330 | 1000 | 600 | 600,000 | 680 | 680,000 | +80,000 | +13.3% |
| 2317 | 2000 | 110 | 220,000 | 120 | 240,000 | +20,000 | +9.1% |
| 2454 | 500 | 850 | 425,000 | 900 | 450,000 | +25,000 | +5.9% |

**組合總計**:
- 總成本：1,245,000
- 當前市值：1,370,000
- 總損益：+125,000
- 報酬率：+10.0%

---

## 🎭 市場情緒分析

### 功能特色

分析整體市場情緒，判斷市場處於貪婪還是恐懼狀態。

### 核心指標

#### 1. 市場廣度 (Market Breadth)

衡量市場中上漲與下跌股票的比例。

- **上漲家數**: 期間內收盤價上漲的股票數
- **下跌家數**: 期間內收盤價下跌的股票數
- **平盤家數**: 價格不變的股票數
- **上漲比例**: 上漲家數 / 總家數 × 100%
- **漲跌比**: 上漲家數 / 下跌家數
- **成交量比**: 上漲股票成交量 / 下跌股票成交量

**解讀**:
- 上漲比例 > 70%: 極度樂觀 🟢
- 上漲比例 60-70%: 樂觀 🟢
- 上漲比例 45-60%: 中性 ⚪
- 上漲比例 35-45%: 悲觀 🔴
- 上漲比例 < 35%: 極度悲觀 🔴

#### 2. 恐懼貪婪指數 (Fear & Greed Index)

綜合多項指標計算市場情緒分數（0-100）。

**組成要素**:

1. **價格動能** (30% 權重)
   - 計算股票池的平均報酬率
   - 報酬率越高，分數越高

2. **市場廣度** (25% 權重)
   - 上漲股票比例越高，分數越高

3. **波動率** (20% 權重)
   - 波動率越低，代表貪婪（分數高）
   - 波動率越高，代表恐懼（分數低）

4. **成交量** (15% 權重)
   - 成交量放大，代表貪婪
   - 成交量萎縮，代表恐懼

5. **新高新低** (10% 權重)
   - 創新高股票多，代表貪婪
   - 創新低股票多，代表恐懼

**指數解讀**:
- 75-100: 極度貪婪 🔥
- 55-75: 貪婪 😊
- 45-55: 中性 😐
- 25-45: 恐懼 😨
- 0-25: 極度恐懼 😱

**投資建議**:
- **極度恐懼**: 可能是買入機會（逆向操作）
- **恐懼**: 可考慮分批進場
- **中性**: 保持觀望
- **貪婪**: 考慮獲利了結
- **極度貪婪**: 注意風險，避免追高

#### 3. 產業輪動 (Sector Rotation)

分析不同產業的相對表現，判斷資金流向。

**分析產業**:
- 半導體: 2330, 2454, 2303
- 金融: 2881, 2882, 2886
- 電子製造: 2317, 2382
- 傳產: 2308, 1301
- 通訊: 2412

**產業指標**:
- 產業平均報酬率
- 產業波動率
- 產業相對強度
- 領漲/落後產業

**輪動策略**:
- 資金從防禦性產業（金融、傳產）流向成長型產業（科技、半導體） → 市場樂觀
- 資金從成長型產業流向防禦性產業 → 市場轉為保守

#### 4. 市場展望報告

系統自動生成的市場分析報告，包含：

1. **市場廣度分析**
   - 上漲/下跌家數統計
   - 漲跌比分析
   - 市場情緒判斷

2. **恐懼貪婪指數**
   - 總分與情緒判斷
   - 各項得分明細
   - 歷史比較

3. **產業輪動**
   - 領漲產業
   - 落後產業
   - 產業表現排名

4. **投資建議**
   - 基於市場情緒的策略建議
   - 風險警示
   - 操作方向

### 使用流程

1. **設定股票池**: 輸入至少 5-10 支代表性股票
   - 建議包含不同產業的龍頭股
   - 例如：2330,2317,2454,2308,2881,2882,2886,2891,2892,2303

2. **選擇分析週期**: 7-90 天
   - 短期（7-14天）：觀察近期情緒變化
   - 中期（30天）：平衡的分析週期
   - 長期（60-90天）：整體趨勢判斷

3. **點擊分析**: 系統計算所有指標

4. **查看結果**:
   - 市場廣度圖表
   - 恐懼貪婪指數儀表盤
   - 各項得分明細
   - 產業輪動分析
   - 市場展望報告

### 實際應用

#### 場景 1: 市場過熱警示
- 恐懼貪婪指數：85（極度貪婪）
- 市場廣度：上漲比例 78%
- **建議**: 考慮獲利了結，避免追高

#### 場景 2: 恐慌性賣壓
- 恐懼貪婪指數：18（極度恐懼）
- 市場廣度：上漲比例 22%
- **建議**: 可能是逢低布局機會（逆向操作）

#### 場景 3: 產業輪動
- 半導體產業報酬率：+15%（領漲）
- 金融產業報酬率：-3%（落後）
- **建議**: 資金流向科技股，市場偏好成長

---

## 💡 使用建議

### 1. 技術分析最佳實踐

- **不要依賴單一指標**: 綜合多個指標判斷
- **結合趨勢與震盪**: MA/MACD 看趨勢，RSI/KDJ 看震盪
- **注意背離訊號**: 價格與指標方向不一致時要警覺
- **設定停損停利**: 依據 ATR 設定合理的停損點
- **確認成交量**: 突破或反轉需要成交量配合

### 2. 多股比較技巧

- **同產業比較**: 比較同產業股票找出強者
- **大盤比較**: 與大盤指數比較判斷相對強弱
- **風險調整**: 不只看報酬，也要考慮夏普比率
- **分散投資**: 選擇相關性低的股票降低風險

### 3. 投資組合管理原則

- **定期再平衡**: 每季調整一次持倉比例
- **風險控管**: 單一股票不超過組合 30%
- **分散配置**: 至少 5-10 支不同產業股票
- **記錄成本**: 準確記錄每次買賣的成本與時間
- **績效檢討**: 定期分析績效並調整策略

### 4. 市場情緒應用

- **逆向思維**: 極度恐懼時買入，極度貪婪時賣出
- **趨勢跟隨**: 中度貪婪時順勢操作
- **產業配置**: 根據產業輪動調整持倉
- **風險警示**: 市場過熱時減碼，恐慌時加碼

### 5. 綜合運用

建議將四個模組結合使用：

1. **市場情緒** → 判斷大環境（是否適合進場）
2. **多股比較** → 選股（找出強勢標的）
3. **技術分析** → 擇時（找到最佳進場點）
4. **投資組合** → 管理（追蹤績效與風險）

---

## ⚠️ 風險提示

1. **歷史數據**: 所有分析基於歷史數據，無法保證未來表現
2. **技術指標局限**: 技術分析有其限制，應結合基本面分析
3. **市場變化**: 市場環境快速變化，需及時調整策略
4. **示範資料**: 部分功能使用示範資料，實際投資請查證真實資訊
5. **專業諮詢**: 重大投資決策前請諮詢專業財務顧問

---

## 📚 延伸閱讀

### 技術分析相關
- 《日本蠟燭圖技術》- Steve Nison
- 《技術分析完全手冊》- John Murphy

### 投資組合管理
- 《漫步華爾街》- Burton Malkiel
- 《投資最重要的事》- Howard Marks

### 市場情緒
- 《非理性繁榮》- Robert Shiller
- 《金融心理學》- Lars Tvede

---

## 📞 技術支援

### 相關檔案

- **後端模組**:
  - [backend/modules/technical_analyzer.py](backend/modules/technical_analyzer.py)
  - [backend/modules/stock_comparator.py](backend/modules/stock_comparator.py)
  - [backend/modules/portfolio_manager.py](backend/modules/portfolio_manager.py)
  - [backend/modules/market_sentiment.py](backend/modules/market_sentiment.py)

- **前端介面**: [app.py](app.py)

### 功能狀態

✅ 技術分析 - 已完成
✅ 多股比較 - 已完成
✅ 投資組合管理 - 已完成
✅ 市場情緒分析 - 已完成

---

**系統版本**: v2.0 Professional
**開發**: Claude Sonnet 4.5
**最後更新**: 2026-01-10

**注意**: 本系統僅供教育和研究用途，不構成投資建議。投資前請諮詢專業財務顧問。
